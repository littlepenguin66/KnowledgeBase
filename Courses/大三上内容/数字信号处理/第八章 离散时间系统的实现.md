# 第八章 离散时间系统的实现

### 一、引言

离散时间系统在数字信号处理中起着核心作用，而如何将其从理论上的系统描述转化为实际可运行、可实现的形式是至关重要的。这涉及到选择合适的结构、考虑硬件或软件实现的可行性、计算复杂度以及对系统性能的影响等多方面因素。通过对离散时间系统实现方式的研究，能够将系统的功能在实际的数字设备（如数字信号处理器、FPGA等）或软件环境中有效落地，实现对输入信号的预期处理，例如滤波、信号特征提取等操作。

### 二、离散时间系统的结构表示

#### 1. 线性常系数差分方程

离散时间系统常用线性常系数差分方程来描述，其一般形式为：

$$
\sum_{k = 0}^{N} a_k y(n - k)=\sum_{m = 0}^{M} b_m x(n - m)
$$

其中，$x(n)$是输入序列，$y(n)$是输出序列，$a_k$和$b_m$是常数系数，$N$和$M$分别表示差分方程的阶数。这个方程体现了系统输出与输入以及过去输出值之间的关系，通过给定初始条件和输入序列，可以求解出系统的输出响应。例如，对于一阶差分方程$y(n) = b_0 x(n) - a_1 y(n - 1)$，它描述了一种简单的系统，当前输出取决于当前输入以及上一时刻的输出，可据此分析系统的一些特性，如稳定性、因果性等，并且是构建系统具体实现结构的基础。

#### 2. 系统的框图表示

* **基本单元**：  
  离散时间系统的框图由几种基本单元组成，包括加法器、乘法器和延时单元（通常用单位延时$z^{-1}$表示，意味着将信号延迟一个采样周期）。加法器用于将多个信号相加，乘法器用于实现信号与常数或其他信号的相乘，延时单元则用于体现系统输出对过去输入或输出的依赖关系，通过这些基本单元的组合可以构建出复杂的系统结构，直观地展示系统的运算流程。
* **示例**：  
  以二阶差分方程$y(n) = b_0 x(n) + b_1 x(n - 1) + b_2 x(n - 2) - a_1 y(n - 1) - a_2 y(n - 2)$为例，其对应的框图结构中，有多个乘法器分别与输入$x(n)$、$x(n - 1)$、$x(n - 2)$以及输出$y(n - 1)$、$y(n - 2)$相乘，然后通过加法器将这些乘积进行相应的加、减运算，中间穿插着延时单元来实现对过去时刻信号的引用，从而构成完整的系统结构，清晰地展现了系统是如何根据输入产生输出的。

### 三、系统实现的基本结构

#### 1. 直接型结构

* **I型直接型**：

  * **构建方式**：直接根据线性常系数差分方程来构建结构。对于差分方程$\sum_{k = 0}^{N} a_k y(n - k)=\sum_{m = 0}^{M} b_m x(n - m)$，将输入部分$\sum_{m = 0}^{M} b_m x(n - m)$对应的乘法器和加法器结构与输出部分$\sum_{k = 0}^{N} a_k y(n - k)$对应的乘法器、加法器以及延时单元结构依次排列，先计算输入信号的加权和，再经过由延时单元和反馈系数$a_k$构成的反馈回路来生成最终的输出$y(n)$。
  * **特点**：结构直观，直接反映了差分方程的各项运算关系，但缺点是当系统阶数较高时，需要较多的乘法器和延时单元，硬件实现成本可能较高，并且由于信号传输路径长短不一，可能存在不同程度的延时差异，对系统的稳定性和精度等方面会有一定影响。
* **II型直接型（典范型）** ：

  * **构建方式**：通过对系统函数（$H(z)=\frac{\sum_{m = 0}^{M} b_m z^{-m}}{\sum_{k = 0}^{N} a_k z^{-k}}$）的分子分母分别进行因式分解和重新组合构建而成。它将系统的零点和极点部分的实现结构进行了整合，使得结构更加紧凑。具体来说，先分别实现分子多项式对应的前馈部分（与输入相关的加权和运算）和分母多项式对应的反馈部分（与过去输出相关的运算及延时），然后将两者合理连接起来形成完整的系统结构。
  * **特点**：相较于I型直接型，在相同系统阶数下，II型直接型所需的乘法器数量可能相同，但延时单元的使用更加高效，结构上更为规整，减少了因信号传输路径差异带来的一些问题，在硬件实现中往往更便于布局布线，对提高系统的稳定性和整体性能有一定帮助，所以在实际应用中使用较为广泛。

#### 2. 级联型结构

* **原理**：  
  将系统函数$H(z)$分解成多个一阶或二阶子系统函数的乘积形式，即$H(z)=H_1(z)H_2(z)\cdots H_K(z)$，每个子系统都用直接型等合适的结构实现，然后将这些子系统级联起来，前一个子系统的输出作为后一个子系统的输入，依次传递信号，最终得到整个系统的输出。这种分解通常是基于对系统函数的极点和零点进行分组和因式分解来实现的，例如对于一个高阶系统，可以把靠近的极点和零点组合在一起构成一个二阶子系统，这样便于分析和调整系统的频率响应等特性。
* **优点**：  
  在设计和调整系统性能方面具有优势。因为每个子系统相对独立，若要改变系统的频率响应，比如调整某个频段的滤波特性，只需修改相应子系统的参数即可，不会对其他子系统产生太大影响，便于系统的优化和调试。同时，在硬件实现中，不同子系统可以采用不同的硬件模块来实现，便于进行模块化设计和并行处理，提高整体的处理速度和效率，而且对硬件资源的利用也更加灵活。
* **缺点**：  
  级联的顺序会影响系统最终的性能，不同的级联顺序可能导致系统的量化误差等情况有所不同，所以需要合理选择级联顺序，并且由于存在多个子系统级联，信号传输过程中可能会累积一定的延时，需要在实际应用中加以考虑和处理。

#### 3. 并联型结构

* **原理**：  
  把系统函数$H(z)$分解为多个子系统函数的并联形式，即$H(z)=H_1(z)+H_2(z)+\cdots +H_L(z)$，每个子系统同样可以用直接型等结构实现，各子系统并行接收输入信号$x(n)$，然后将各自的输出相加得到整个系统的最终输出$y(n)$。这种分解一般是通过部分分式展开等方法，将系统函数按照极点情况分解为多个简单分式对应的子系统函数之和，对于实系数系统，通常会分解出一阶和二阶子系统，便于实现和分析。
* **优点**：  
  计算速度相对较快，因为各子系统是并行工作的，只要硬件资源允许，可以同时对输入信号进行处理，然后快速汇总得到输出，尤其适用于对实时性要求较高的应用场景。而且在进行数字滤波器设计等应用中，不同子系统可以针对不同的频率范围进行设计，比如有的子系统负责滤除低频噪声，有的负责处理高频部分，便于实现复杂的滤波功能和对不同频段的精确控制。
* **缺点**：  
  和级联型类似，由于存在多个子系统并行，在硬件实现时需要分配足够的硬件资源来保证各子系统同时运行，可能会增加硬件成本和复杂度。另外，各子系统之间的参数匹配和整体协调也需要精心设计，否则可能会影响系统的稳定性和最终的输出效果。

### 四、有限字长效应

#### 1. 量化误差的产生

在实际的数字系统实现中，由于数字设备的字长是有限的（例如用一定位数的二进制数来表示信号和系数等），会不可避免地产生量化误差。当对输入信号、系统系数以及中间运算结果进行量化（将连续的数值转换为有限离散值）时，就会引入这种误差，它类似于一种噪声，会影响系统的性能，使实际输出与理论输出之间出现偏差。例如，对一个模拟信号进行采样并量化转换为数字信号的过程中，原本连续变化的信号幅度被近似为有限个离散的量化电平，必然会丢失一部分信息，产生量化误差；同样，系统系数在存储和运算时也会因有限字长而被量化，改变了原本精确的系统特性。

#### 2. 量化误差对系统性能的影响

* **稳定性影响**：  
  量化误差可能会改变系统函数的极点位置，如果极点原本在单位圆内（系统稳定的条件），但由于量化误差导致极点移动到单位圆外或在单位圆上处于临界不稳定状态，那么系统就可能变得不稳定，无法正常工作。例如在高阶系统中，即使是较小的量化误差积累，也有可能使极点位置发生明显变化，从而影响系统的稳定性，所以在设计和实现系统时，要充分考虑如何控制量化误差以维持系统的稳定。
* **频率响应变化**：  
  量化误差会使系统的实际频率响应与理论设计的频率响应出现偏差。原本设计好的具有特定滤波特性（如低通、高通等）的系统，可能因为量化误差，在某些频率点上的幅度衰减或相位变化不符合预期，导致滤波效果变差，影响对信号的处理质量。例如在数字滤波器实现中，由于量化误差，可能会使滤波器的通带不再平坦，阻带衰减不够等情况出现，需要通过合适的量化策略和系统结构优化来尽量减小这种影响。

#### 3. 减小量化误差的方法

* **增加字长**：  
  最直接的方法就是使用更长的字长来表示信号和系数等，这样可以减小量化间隔，从而降低量化误差。例如从8位字长增加到16位字长，能更精确地表示数值，使量化误差变得更小，但这会增加硬件的存储成本和运算复杂度，并且在一些资源受限的情况下可能无法实现无限的字长增加，所以需要综合考虑系统性能和资源限制来选择合适的字长。
* **优化系统结构**：  
  选择合适的系统实现结构可以在一定程度上减小量化误差的影响。比如，并联型结构在某些情况下相对直接型结构可能对量化误差更不敏感，因为各子系统并行处理，量化误差的累积方式不同；另外，在进行级联型结构设计时，合理安排级联顺序，也能改善量化误差对系统性能的影响，使系统在有限字长条件下能更接近理论设计的性能。
* **采用合适的量化方案**：  
  例如采用舍入或截断等不同的量化方式，会对量化误差的大小和统计特性产生影响。舍入量化通常能使量化误差的均值为零，在一些对误差统计特性有要求的系统中更适用；而截断量化相对简单，但可能会引入一定的偏差，需要根据具体系统的特点和需求来选择合适的量化方案，以控制量化误差对系统的不良影响。

### 五、系统实现的硬件与软件平台

#### 1. 数字信号处理器（DSP）

* **特点与优势**：  
  DSP芯片是专门为数字信号处理任务设计的微处理器，具有专门的硬件乘法器、高速的数据处理能力以及适合信号处理的指令集。它能够快速地执行诸如乘法、加法、移位等运算，并且支持高效的循环结构和数据寻址方式，便于实现离散时间系统中的各种运算，特别是对于像滤波、卷积等需要大量重复运算的操作，能在短时间内完成，满足实时性要求较高的应用场景，如音频处理、通信中的信号调制解调等。
* **系统实现示例**：  
  在DSP上实现一个数字滤波器时，可以利用其内置的乘法器和累加器，按照滤波器的结构（如直接型、级联型等）编写相应的程序代码，将输入信号的采样值依次读入，通过执行指令完成滤波运算，然后输出滤波后的结果。同时，DSP还可以方便地与其他外部设备（如模数转换器、数模转换器等）进行连接，实现完整的信号采集、处理和输出链路。

#### 2. 现场可编程门阵列（FPGA）

* **特点与优势**：  
  FPGA是一种可编程的硬件逻辑器件，它由大量的可配置逻辑块（CLB）、输入输出模块（IOB）和可编程连线资源组成。用户可以通过硬件描述语言（如VHDL、Verilog等）对其进行编程，根据离散时间系统的具体结构定制硬件电路，实现高度并行的运算，非常适合处理需要高速、大规模并行计算的系统，如雷达信号处理、图像处理中的高速滤波等应用。而且FPGA具有可重编程性，当系统需要修改或升级功能时，只需重新编写并下载程序即可，灵活性很强。
* **系统实现示例**：  
  以实现一个离散时间系统的级联型结构为例，在FPGA中可以使用硬件描述语言分别描述各个子系统的逻辑功能，然后通过可编程连线将它们按照级联顺序连接起来，配置好输入输出端口，形成完整的硬件电路。在运行时，输入信号并行地进入各子系统，各子系统同时进行运算，最后汇总得到输出信号，充分发挥了FPGA并行处理的优势，提高系统的处理速度和效率。

#### 3. 软件实现（通用编程语言）

* **特点与优势**：  
  使用通用编程语言（如C、Python等）实现离散时间系统具有很高的灵活性和便捷性。开发人员可以方便地进行算法设计、调试和修改，无需像硬件实现那样考虑复杂的硬件电路搭建和物理限制。而且可以利用编程语言丰富的库函数和面向对象等编程特性，快速构建系统的功能模型，适用于对实时性要求不是特别高、更注重算法验证和快速开发的应用场景，比如在科研、教学中的信号处理算法模拟等。
* **系统实现示例**：  
  在Python中，可以利用`numpy`​等库来处理数组形式的输入信号，通过编写函数来实现离散时间系统的差分方程运算。例如，对于一个简单的一阶离散时间系统，根据其差分方程编写相应的Python函数，接收输入信号数组作为参数，在循环中按照差分方程的计算规则对每个采样点进行运算，得到输出信号数组，从而实现系统在软件环境中的模拟运行，便于分析系统性能和验证算法的正确性。

总之，离散时间系统的实现涉及多方面的知识和技术，从系统结构的选择、有限字长效应的考虑到硬件和软件平台的应用，都需要根据具体的应用需求、性能要求以及资源限制等因素综合权衡，以实现高效、稳定且符合预期功能的离散时间系统。
