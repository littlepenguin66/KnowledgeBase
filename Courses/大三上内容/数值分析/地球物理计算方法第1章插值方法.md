# 地球物理计算方法第1章插值方法

[插值例子](插值例子.md)

# 第 1 章插值方法

## 1.插值法概念

### 1.1 问题的提出

已知$y_{i}=f(x_{i})$，$x_{i} \in[a, b]$，$i = 0,1,2,\cdots,n$。求$f(x)$在$x'\in[a, b]$处的函数值$f(x')$，$x'$称为插值点，$y_{i}=f(x_{i})$称为样本值，$x_{0},x_{1},\cdots,x_{n}$称为插值节点。

实际问题中函数$f(x)$可能没有数学表达式，只有离散数据，构造简单函数$P(x)$近似$f(x)$，通过处理$P(x)$获得$f(x)$的结果。若$P(x)$取给定离散数据，则$P(x)$为$f(x)$的插值函数。

### 1.2 解决办法

构造简单函数解析表达式近似求解：

1. 构造$P(x)$替代未知（或复杂）函数$f(x)$，$P(x)$为$f(x)$插值函数且满足$P(x_{i}) = f(x_{i})$，$(i = 0,1,\cdots,n)$。
2. 用$P(x')$近似$f(x')$。已知函数$y = f(x)$在$n + 1$个互异点$x_{0},x_{1},\cdots,x_{n}$上函数值分别为$y_{0},y_{1},\cdots,y_{n}$，构造$P(x)$满足条件，此类问题为插值问题，$P(x)$为插值函数，$f(x)$为被插值函数，$x_{0},x_{1},\cdots,x_{n}$为插值节点。

从几何上看，插值法是找曲线$y = P(x)$使其过给定的$n + 1$个点$(x_{i},y_{i})$，近似已知曲线$y = f(x)$，$P(x)$需过$f(x)$的$n + 1$个点。

## 2.插值方法

### 2.1 泰勒（Taylor）插值

1. **问题描述**

    * 已知$x_{0}$和该点的$k$阶导数值$y_{0}^{(k)}$（$k = 0,1,2,\cdots,n$），要求构造$n$次插值多项式$P_{n}(x)$，使其满足$P_{n}(x_{0}) = y_{0}$，$P_{n}'(x_{0}) = y_{0}'$，$\cdots$，$P_{n}^{(k)}(x_{0}) = y_{0}^{(k)}$。
2. **插值方法**

    * 利用$f(x)$在$x_{0}$的泰勒展开多项式来构建$P_{n}(x)$，公式为$P_{n}(x)=f(x_{0})+f'(x_{0})(x - x_{0})+\frac{f''(x_{0})}{2!}(x - x_{0})^{2}+\cdots+\frac{f^{(n)}(x_{0})}{n!}(x - x_{0})^{n}$。
3. **误差分析**

    * 其误差为$R_{n}(x)=f(x)-P_{n}(x)=\frac{f^{(n + 1)}(\xi)}{(n + 1)!}(x - x_{0})^{n + 1}$，其中$\xi$在$x$与$x_{0}$之间。
4. **例题应用**

    * 例如，已知$f(x)=\sqrt{x}$在$x_{0}=100$的一次和二次泰勒多项式，求$f(115)=\sqrt{115}$的近似值并估计误差。
    * 解：由$f(x)=\sqrt{x}$知，$f'(x)=\frac{1}{2\sqrt{x}}$，$f''(x)=\frac{-1}{4x\sqrt{x}}$。
    * 对于一次泰勒多项式$P_{1}(x)=f(x_{0})+f'(x_{0})(x - x_{0})$，将$x_{0}=100$，$f(x_{0}) = 10$，$f'(x_{0})=\frac{1}{20}$代入可得$P_{1}(x)=10+\frac{1}{20}(x - 100)=5 + 0.05x$。当$x = 115$时，$f(115)=\sqrt{115}\approx P_{1}(115)=10.75$。
    * 误差估计：$0<\vert R_{1}(x)\vert=\vert\frac{f''(\xi)}{2}(x - x_{0})^{2}\vert<\frac{f''(x_{0})}{2}(115 - 100)^{2}=0.028125$，近似值$10.75$的误差大约为$0.028125<\frac{1}{2}\times10^{-1}$，因而它有$3$位有效数字。
    * 对于二次泰勒多项式$P_{2}(x)=P_{1}(x)+\frac{f''(x_{0})}{2}(x - x_{0})^{2}$，将$x_{0}=100$，$f''(x_{0})=\frac{-1}{4000}$代入可得$P_{2}(x)=5 + 0.05x-\frac{1}{8000}(x - 100)^{2}$。当$x = 115$时，$f(115)=\sqrt{115}\approx P_{2}(115)=10.721$。
    * 误差估计：$0<\vert R_{2}(x)\vert=\vert\frac{f''(\xi)}{3!}(x - x_{0})^{3}\vert<\frac{f''(x_{0})}{6}(115 - 100)^{3}=0.000703125<\frac{1}{2}\times10^{-2}$，所以有$4$位有效数字。
5. **泰勒插值存在的问题**

    * 需要提供函数$f(x)$的前$n + 1$阶导数值，这一要求比较苛刻。即使函数存在$n + 1$阶导数，计算这些导数值的工作量也通常较大。
    * 要求步长$h=\vert x - x_{0}\vert$为较小量。若$h$较大，则计算的误差就会很大。泰勒插值实质是用一个已知点$x_{0}$的函数值及各阶导数值来插值出其他点的函数值。

泰勒插值在理论上为函数逼近提供了一种方法，但在实际应用中，由于其对函数导数信息要求较高以及对步长的限制，使用场景相对有限，不过在一些对函数局部性质研究或在已知点附近进行近似计算且能方便获取高阶导数信息时仍有一定作用。

### 2.2 拉格朗日插值

1. **问题提出**

    * 已知函数$y = f(x)$在$n + 1$个点$x_{0},x_{1},\cdots,x_{n}$上的函数值$y_{0},y_{1},\cdots,y_{n}$，要求在任意一点$x'$（“'”读作$prime$）处的函数值$f(x')$。这里函数$y = f(x)$可能未知或复杂难以计算其在$x'$处的值。
2. **解决方法**

    * 构造一个$n$次代数多项式函数$P_{n}(x)$来替代未知（或复杂）函数$y = f(x)$，然后用$P_{n}(x')$作为函数值$f(x')$的近似值。设$P_{n}(x)=a_{0}+a_{1}x + a_{2}x^{2}+\cdots+a_{n}x^{n}$，关键在于确定$n + 1$个多项式的系数$a_{0},a_{1},\cdots,a_{n}$。
    * 当多项式函数$P_{n}(x)$同时过已知的$n + 1$个点时，认为$P_{n}(x)$逼近于原来的函数$f(x)$。此时可根据此条件写出非齐次线性方程组$\left\{\begin{array}{c}a_{0}+a_{1}x_{0}+a_{2}x_{0}^{2}+\cdots+a_{n}x_{0}^{n}=y_{0}\\a_{0}+a_{1}x_{1}+a_{2}x_{1}^{2}+\cdots+a_{n}x_{1}^{n}=y_{1}\\\cdots\\a_{0}+a_{1}x_{n}+a_{2}x_{n}^{2}+\cdots+a_{n}x_{n}^{n}=y_{n}\end{array}\right.$。
    * 该方程组系数矩阵的行列式$D$为范德蒙行列式$D=\left|\begin{array}{ccccc}1&x_{0}&x_{0}^{2}&\cdots&x_{0}^{n}\\1&x_{1}&x_{1}^{2}&\cdots&x_{1}^{n}\\\vdots&\vdots&\vdots&&\vdots\\1&x_{n}&x_{n}^{2}&\cdots&x_{n}^{n}\end{array}\right|=\prod_{n\geq i>j\geq0}(x_{i}-x_{j})$。当$n + 1$个点的横坐标$x_{0},x_{1},\cdots,x_{n}$互异时，行列式$D$不等于零，方程组有唯一解（克莱姆法则）。
3. **拉格朗日插值公式**

    * 当确定了上述方程组有唯一解后，可得到拉格朗日插值公式。对于给定的$n + 1$个节点$x_{0},x_{1},\cdots,x_{n}$及其对应的函数值$y_{0},y_{1},\cdots,y_{n}$，拉格朗日插值多项式$P_{n}(x)$可表示为$P_{n}(x)=\sum_{k = 0}^{n}y_{k}l_{k}(x)$，其中$l_{k}(x)=\prod_{\substack{j = 0\\j\neq k}}^{n}\frac{x - x_{j}}{x_{k}-x_{j}}$，称为插值基函数。
    * 例如，对于两个节点$x_{0}$和$x_{1}$的线性插值（$n = 1$）：

      * 直线的两点式表达式为$p_{1}(x)=y_{0}+\frac{y_{1}-y_{0}}{x_{1}-x_{0}}(x - x_{0})$，进一步变形可得$p_{1}(x)=y_{0}\frac{x - x_{1}}{x_{0}-x_{1}}+y_{1}\frac{x - x_{0}}{x_{1}-x_{0}}=y_{0}l_{0}(x)+y_{1}l_{1}(x)$，其中$l_{0}(x)=\frac{x - x_{1}}{x_{0}-x_{1}}$<span data-type="text" style="background-color: var(--b3-card-error-background); color: var(--b3-card-error-color);">，</span>$l_{1}(x)=\frac{x - x_{0}}{x_{1}-x_{0}}$。
    * 对于三个节点$x_{0}$、$x_{1}$和$x_{2}$的抛物线插值（$n = 2$）：

      * 二次插值多项式$P_{2}(x)=y_{0}l_{0}(x)+y_{1}l_{1}(x)+y_{2}l_{2}(x)$，其中$l_{0}(x)=\frac{(x - x_{1})(x - x_{2})}{(x_{0}-x_{1})(x_{0}-x_{2})}$<span data-type="text" style="background-color: var(--b3-card-error-background); color: var(--b3-card-error-color);">，</span>$l_{1}(x)=\frac{(x - x_{0})(x - x_{2})}{(x_{1}-x_{0})(x_{1}-x_{2})}$<span data-type="text" style="background-color: var(--b3-card-error-background); color: var(--b3-card-error-color);">，</span>$l_{2}(x)=\frac{(x - x_{0})(x - x_{1})}{(x_{2}-x_{0})(x_{2}-x_{1})}$。
    * 一般地，对于$n$次拉格朗日插值多项式，就是通过这样的方式构造插值基函数，然后线性组合得到。
4. **拉格朗日插值的算法流程图（简单示意）**

    * 开始

      * 输入$x$及$(x_{i},y_{i})$，$i = 0,1,\cdots,n$。
      * 初始化$y = 0$，$k = 0$。
    * 循环计算

      * 对于$i = 0$到$n$：

        * 计算$l = 1$。
        * 对于$j = 0$到$n$（$j\neq i$）：

          * 计算$l = l\times\frac{x - x_{j}}{x_{i}-x_{j}}$。
        * 更新$y = y + y_{i}\times l$。
      * $k = k + 1$。
    * 结束判断

      * 如果$k = n$，输出$y$；否则继续循环。
5. **总结拉格朗日插值公式特点**

    * 每一项中的分子是关于$x$的$n$次多项式，分母是一个常数。
    * 每一项的系数为$y_{k}$。
    * 每一项的分子和分母的形式非常相似。
6. **插值余项**

    * 设$P_{n}(x)$近似$f(x)$，产生的截断误差为$R_{n}(x)=f(x)-P_{n}(x)$，则$R_{n}(x)$为$n$次多项式$P_{n}(x)$的插值余项。
    * 拉格朗日余项定理（定理3）：当函数$f(x)$足够光滑，即满足$f(x)$在区间$[a,b]$上连续，且具有直至$n + 1$阶导数，则总存在相应的点$\xi$，$\xi\in[a,b]$使得$R_{n}(x)=f(x)-P_{n}(x)=\frac{f^{(n + 1)}(\xi)}{(n + 1)!}\omega_{n + 1}(x)$，其中$\omega_{n + 1}(x)=(x - x_{0})(x - x_{1})\cdots(x - x_{n})$。
    * 在实际应用中，通常难以确定$\xi$的值，但可以在区间$[a,b]$上估算出$\vert f^{(n + 1)}(\xi)\vert$的上界$M$，即$\vert f^{(n + 1)}(\xi)\vert\leq M$，从而得到截断误差的范围$\vert R_{n}(x)\vert\leq\frac{M}{(n + 1)!}\vert\omega_{n + 1}(x)\vert$。例如，当$n = 1$时，线性插值余项为$R_{1}(x)=\frac{1}{2}f''(\xi)\omega_{2}(x)=\frac{1}{2}f''(\xi)(x - x_{0})(x - x_{1})$，$\xi\in[x_{0},x_{1}]$；当$n = 2$时，抛物插值余项为$R_{2}(x)=\frac{1}{6}f'''(\xi)(x - x_{0})(x - x_{1})(x - x_{2})$，$\xi\in[x_{0},x_{2}]$。
    * 拉格朗日插值只适用于近似光滑性好的函数，因为插值余项中含有高阶导数$f^{(n + 1)}(\xi)$。

拉格朗日插值方法在已知离散点的函数值时，能够方便地构造出插值多项式来近似未知函数在其他点的值，在数值计算、数据拟合等领域有广泛应用。但当节点数增加时，计算插值基函数的工作量会增大，且没有承袭性（增加节点需重新计算所有插值基函数）。

### 2.3牛顿插值公式

1. **内容引入**

    * 拉格朗日插值的缺点是无承袭性（继承性）。对于具有$n + 1$（$n\geq0$）个插值节点的多项式插值问题，若已得到对应的插值多项式$P_{n}(x)$，当需增加一个插值节点$(x_{n + 1},f(x_{n + 1}))$并利用已知的$P_{n}(x)$构造新的具有$n + 2$个节点的插值多项式$P_{n + 1}(x)$时，拉格朗日插值需要重新计算所有的插值基函数$l_{i}(x)$。而牛顿插值属于具有继承性的插值多项式，即$P_{n + 1}(x)=P_{n}(x)+H_{n + 1}(x)$，只要确定了$H_{n + 1}(x)$，就可得到$P_{n + 1}(x)$。
2. **差商及其性质**

    * **定义**

      * 一阶差商：$f[x_{0},x_{1}]=\frac{f(x_{1})-f(x_{0})}{x_{1}-x_{0}}$。
      * 二阶差商（一阶差商的差商）：$f[x_{0},x_{1},x_{2}]=\frac{f[x_{1},x_{2}]-f[x_{0},x_{1}]}{x_{2}-x_{0}}$。
      * $n$阶差商：$f[x_{0},x_{1},\cdots,x_{n}]=\frac{f[x_{1},x_{2},\cdots,x_{n}]-f[x_{0},x_{1},\cdots,x_{n - 1}]}{x_{n}-x_{0}}$。
      * 特别地，$0$阶差商为$f(x_{i})$。
    * **差商的显式表达式**

      * 例如，$f[x_{0},x_{1}]=\frac{f(x_{1})-f(x_{0})}{x_{1}-x_{0}}=\frac{f(x_{0})}{x_{0}-x_{1}}+\frac{f(x_{1})}{x_{1}-x_{0}}$。
      * $f[x_{0},x_{1},x_{2}]=\frac{f[x_{1},x_{2}]-f[x_{0},x_{1}]}{x_{2}-x_{0}}=\frac{\frac{f(x_{1})}{x_{1}-x_{2}}+\frac{f(x_{2})}{x_{2}-x_{1}}-\left(\frac{f(x_{0})}{x_{0}-x_{1}}+\frac{f(x_{1})}{x_{1}-x_{0}}\right)}{x_{2}-x_{0}}=\frac{f(x_{0})}{(x_{0}-x_{1})(x_{0}-x_{2})}+\frac{f(x_{1})}{(x_{1}-x_{0})(x_{1}-x_{2})}+\frac{f(x_{2})}{(x_{2}-x_{0})(x_{2}-x_{1})}$。
      * 依次类推，$f[x_{0},x_{1},\cdots,x_{n}]=\sum_{k = 0}^{n}\frac{f(x_{k})}{\prod_{\substack{j = 0\\j\neq k}}^{n}(x_{k}-x_{j})}$。
    * **差商的性质**：差商的值与节点的次序无关，即$f[x_{0},x_{1}]=f[x_{1},x_{0}]$，$f[x_{0},x_{1},\cdots,x_{n}]=\sum_{k = 0}^{n}\frac{f(x_{k})}{\prod_{\substack{j = 0\\j\neq k}}^{n}(x_{k}-x_{j})}$，$f[x_{i},x_{j},x_{k}]=f[x_{i},x_{k},x_{j}]=f[x_{k},x_{j},x_{i}]$等。
    * |**差商表**：差商计算可用如下表格表示<br />||||||
      |$x_{k}$​|$f(x_{k})$​|一阶差商|二阶差商|三阶差商|四阶差商|
      | :-------------------------------------------------------: | :--------------------: | :--------------------: | :--------------------: | :--------------------: | :--------------------: |
      |$x_{0}$​|$f(x_{0})$​|||||
      |$x_{1}$​|$f(x_{1})$​|$f[x_{0},x_{1}]$​||||
      |$x_{2}$​|$f(x_{2})$​|$f[x_{1},x_{2}]$​|$f[x_{0},x_{1},x_{2}]$​|||
      |$x_{3}$​|$f(x_{3})$​|$f[x_{2},x_{3}]$​|$f[x_{1},x_{2},x_{3}]$​|$f[x_{0},x_{1},x_{2},x_{3}]$​||
      |$x_{4}$​|$f(x_{4})$​|$f[x_{3},x_{4}]$​|$f[x_{2},x_{3},x_{4}]$​|$f[x_{1},x_{2},x_{3},x_{4}]$|$f[x_{0},x_{1},x_{2},x_{3},x_{4}]$​|
3. **牛顿插值多项式**

    * 按照差商的定义，有$f(x)=f(x_{0})+f[x_{0},x](x - x_{0})$，$f[x_{0},x]=f[x_{0},x_{1}]+f[x_{0},x_{1},x](x - x_{1})$，利用差商值与节点顺序无关，$f[x_{0},x_{1},x]=f[x_{0},x_{1},x_{2}]+f[x_{0},x_{1},\cdots,x_{n},x](x - x_{2})$，将后一个式子带入前一个式子，可得：  
      $f(x)=f(x_{0})+f[x_{0},x_{1}](x - x_{0})+f[x_{0},x_{1},x_{2}](x - x_{0})(x - x_{1})+\cdots+f[x_{0},x_{1},\cdots,x_{n}](x - x_{0})(x - x_{1})\cdots(x - x_{n - 1})+f[x_{0},x_{1},\cdots,x_{n},x](x - x_{0})(x - x_{1})\cdots(x - x_{n})$。
    * 令$f(x)=P_{n}(x)+R(x)$，其中$R(x)=f[x_{0},x_{1},\cdots,x_{n},x](x - x_{0})(x - x_{1})\cdots(x - x_{n})$，$P_{n}(x)=f(x_{0})+f[x_{0},x_{1}](x - x_{0})+f[x_{0},x_{1},x_{2}](x - x_{0})(x - x_{1})+\cdots+f[x_{0},x_{1},\cdots,x_{n}](x - x_{0})(x - x_{1})\cdots(x - x_{n - 1})$。
    * 牛顿插值多项式$P_{n}(x)$中$x^{n}$项的系数为$\sum_{k = 0}^{n}\frac{f(x_{k})}{\prod_{\substack{j = 0\\j\neq k}}^{n}(x_{k}-x_{j})}$（拉格朗日插值中$x^{n}$项的系数）。由插值多项式存在唯一性可知，牛顿插值公式与拉格朗日插值公式完全相同。
    * 牛顿插值余项$R_{n}(x)=\vert p_{n}(x)-f(x)\vert=\vert f[x,x_{0},x_{1},\cdots,x_{n}]\prod_{k = 0}^{n}(x - x_{k})\vert=\vert\frac{f^{(n + 1)}(\xi)}{(n + 1)!}\prod_{k = 0}^{n}(x - x_{k})\vert$，并且牛顿插值余项与拉格朗日插值余项相同。
4. **牛顿插值公式特点**

    * **承袭性**：每增加一个节点，插值多项式只增加一项，即$P_{n + 1}(x)=P_{n}(x)+f[x_{0},x_{1},\cdots,x_{n + 1}](x - x_{0})(x - x_{1})\cdots(x - x_{n})$。
    * **计算便利性**：利用差商表计算多个插值节点的牛顿插值多项式，比拉格朗日插值公式计算更方便。例如，已知函数$f(x)$当$x = - 2,-1,0,1$时，其对应函数值为$f(x)=13,-8,-1,4$，求$f(0.5)$的值。

      * |首先根据已知点填写差商表||||||
        |$x_{i}$​|$y_{i}$​|一阶差商|二阶差商|三阶差商|$*$​|
        | :---------------------------------------------------: | :--------------------: | :--------------------: | :--------------------: | :--------------------: | :--------------------: |
        |$-2$​|$13$​||||$1$​|
        |$-1$​|$-8$​|$-21$​|||$(x + 2)$​|
        |$0$​|$-1$​|$7$​|$14$​||$(x + 2)(x + 1)$​|
        |$1$​|$4$​|$5$​|$-1$​|$-5$​|$(x + 2)(x + 1)x$​|
      * 则$f(x)=13 - 21(x + 2)+14(x + 2)(x + 1)-5x(x + 2)(x + 1)$，进而可求得$f(0.5)$的值。
5. **牛顿插值算法流程图**

    * 开始

      * 输入$n$，$x[i],y[i]$，$(i = 0,1,\cdots,n)$，$t$（即插值点$x$）。
      * 初始化$p = f[0]$，$k = 1$，$f[i]=y[i]$，$(i = 0,\cdots,n)$。
    * 循环计算

      * 当$k\leq n$时：

        * 初始化$l = 1$，$i = 1$。
        * 当$i\leq n$时：

          * $l = l\times(t - x[j])$。
          * $j = j + 1$。
          * 如果$j\geq i$，则$i = i + 1$。
        * $f[k]=(f[k - 1]-f[k])/(x[k - i]-x[k])$。
        * $p = p + f[k]\times l$。
        * $k = k + 1$。
    * 输出结果

      * 输出$p$。
    * 结束。

牛顿插值方法通过差商的概念，在计算插值多项式时具有一定优势，尤其是在节点增加时，能够利用已有的计算结果，减少计算量，在数值分析等领域有重要应用。

### 2.4 埃尔米特（Hermite）插值

1. **特点与问题提出**

    * 特点是不但要求插值多项式$P_{n}(x)$与原函数$f(x)$在节点处的函数值相同，而且要求在插值节点处有相同的导数值（包括带完全导数和带不完全导数两类插值问题）。
    * 已知函数$y = f(x)$在$n + 1$个节点$x_{0},x_{1},\cdots,x_{n}$处的函数值为$y_{0},y_{1},\cdots,y_{n}$，导数值为$y_{0}',y_{1}',\cdots,y_{n}'$，要求在$x = x'$时$y = f(x')$的值。
2. **解决方法**

    * 构造一个$2n + 1$次代数多项式函数$H_{2n + 1}(x)$，使得$\left\{\begin{array}{l}H_{2n + 1}(x_{i}) = y_{i}\\H_{2n + 1}'(x_{i}) = y_{i}'\end{array},i = 0,1,\cdots,n\right.$。
    * **基于基函数的方法**

      * $H_{2n + 1}(x)=\sum_{i = 0}^{n}y_{i}\alpha_{i}(x)+\sum_{i = 0}^{n}y_{i}'\beta_{i}(x)=\sum_{i = 0}^{n}\left\{\left[1 - 2(x - x_{i})\sum_{\substack{j = 0\\j\neq i}}^{n}\frac{1}{x_{i}-x_{j}}\right]l_{i}^{2}(x)y_{i}+(x - x_{i})l_{i}^{2}(x)y_{i}'\right\}$，其中$l_{i}(x)=\prod_{\substack{j = 0\\j\neq i}}^{n}\frac{x - x_{j}}{x_{i}-x_{j}}$（利用拉格朗日基函数推导）。
    * **继承 + 待定系数的方法**

      * 设$H_{2n + 1}(x)=a_{0}+a_{1}x + a_{2}x^{2}+\cdots+a_{2n + 1}x^{2n + 1}$，利用$2n + 2$个插值条件建立以$a_{0},a_{1},\cdots,a_{2n + 1}$为未知量的线性方程组，解出$H_{2n + 1}(x)$。
3. **插值余项**

    * $R_{2n + 1}(x)=f(x)-H_{2n + 1}(x)=\frac{f^{(2n + 2)}(\xi)}{(2n + 2)!}(x - x_{0})^{2}\cdots(x - x_{n})^{2}$。对于二点三次Hermite插值余项为$R(x)=f(x)-H_{3}(x)=\frac{f^{(4)}(\xi)}{4!}(x - x_{0})^{2}(x - x_{1})^{2}$。
4. **例题应用**

    * **例1（带完全导数的二点三次埃尔米特插值）**

      * 已知$x_{0}=1$，$x_{1}=2$，$y_{0}=2$，$y_{1}=3$，$y_{0}' = 1$，$y_{1}'=-1$，求满足条件的二点三次埃尔米特插值多项式$H_{3}(x)$。
      * **解法一（根据Hermite插值公式）**

        * 根据公式$H_{3}(x)=\left(1 + 2\frac{x - x_{0}}{x_{1}-x_{0}}\right)\left(\frac{x - x_{1}}{x_{0}-x_{1}}\right)^{2}y_{0}+\left(1 + 2\frac{x - x_{1}}{x_{0}-x_{1}}\right)\left(\frac{x - x_{0}}{x_{1}-x_{0}}\right)^{2}y_{1}+(x - x_{0})\left(\frac{x - x_{1}}{x_{0}-x_{1}}\right)^{2}y_{0}'+(x - x_{1})\left(\frac{x - x_{0}}{x_{1}-x_{0}}\right)^{2}y_{1}'$，代入已知值可得：
        * $H_{3}(x)=\left(1 + 2\frac{x - 1}{2 - 1}\right)\left(\frac{x - 2}{1 - 2}\right)^{2}\times2+\left(1 + 2\frac{x - 2}{1 - 2}\right)\left(\frac{x - 1}{2 - 1}\right)^{2}\times3+(x - 1)\left(\frac{x - 2}{1 - 2}\right)^{2}\times1+(x - 2)\left(\frac{x - 1}{2 - 1}\right)^{2}\times(-1)$
        * $=-2x^{3}+8x^{2}-9x + 5$。
      * **解法二（待定系数法）**

        * 假设$H_{3}(x)=a_{0}+a_{1}x + a_{2}x^{2}+a_{3}x^{3}$，$H_{3}'(x)=a_{1}+2a_{2}x + 3a_{3}x^{2}$。
        * 将$(x_{0},y_{0})=(1,2)$，$(x_{0},y_{0}')=(1,1)$和$(x_{1},y_{1})=(2,3)$，$(x_{1},y_{1}')=(2,-1)$代入$H_{3}(x)$和$H_{3}'(x)$得到如下方程组：  
          $\left\{\begin{array}{l}a_{0}+a_{1}+a_{2}+a_{3}=2\\a_{0}+2a_{1}+4a_{2}+12a_{3}=1\\a_{1}+2a_{2}+3a_{3}=1\\a_{1}+4a_{2}+12a_{3}=-1\end{array}\right.$
        * 解方程组得$\left\{\begin{array}{l}a_{0}=5\\a_{1}=-9\\a_{2}=8\\a_{3}=-2\end{array}\right.$，所以$H_{3}(x)=5 - 9x + 8x^{2}-2x^{3}$。
      * **解法三（继承性 + 待定系数法）**

        * 假设$H_{3}(x)=N_{1}(x)+(ax + b)(x - x_{0})(x - x_{1})$，其中牛顿插值$N_{1}(x)=f(x_{0})+f[x_{0},x_{1}](x%20-%20x_{0})$。
        * 将$(x_{0},y_{0})=(1,2)$和$(x_{1},y_{1})=(2,3)$代入$N_{1}(x)$得$N_{1}(x)=x + 1$，则$H_{3}(x)=ax^{3}+(b - 3a)x^{2}+(2a - 3b + 1)x + 2b + 1$。
        * 再利用$(x_{0},y_{0}')=(1,1)$，$(x_{1},y_{1}')=(2,-1)$代入$H_{3}'(x)$得到$a=-2$，$b = 2$，最终$H_{3}(x)=-2x^{3}+8x^{2}-9x + 5$。
    * **例2（带不完全导数埃尔米特插值多项式构建）**

      * 已知$\begin{array}{|c|c|c|c|}\hline i&0&1&2\\\hline x_{i}&-1&0&1\\\hline y_{i}&-1&0&1\\\hline y_{i}'&&0&\\\hline\end{array}$，求一个不超过三次的插值多项式$H_{3}(x)$，使得$H_{3}(x_{i})=y_{i}(i = 0,1,2)$。
      * **解法一**

        * 利用数据$(x_{i},y_{i})(i = 1,2)$构造一个二次牛顿插值多项式$N_{2}=f(x_{0})+f[x_{0},x_{1}](x%20-%20x_{0})+f[x_{0},x_{1},x_{2}](x%20-%20x_{0})(x - x_{1})=x$。
        * 再令$H_{3}(x)=N_{2}(x)+a(x + 1)x(x - 1)$，由$H_{3}'(0)=0$得到$a = 1$，代入$H_{3}(x)$，得到$H_{3}(x)=x^{3}$。
      * **解法二**

        * 令$H_{3}(x)=a_{0}+a_{1}x + a_{2}x^{2}+a_{3}x^{3}$，利用插值条件$\left\{\begin{array}{l}a_{0}-a_{1}+a_{2}-a_{3}=-1\\a_{0}=0\\a_{0}+a_{1}+a_{2}+a_{3}=1\\a_{1}=0\end{array}\right.$，解得$a_{0}=0$，$a_{1}=0$，$a_{2}=0$，$a_{3}=1$，故得$H_{3}(x)=x^{3}$。

埃尔米特插值在一些需要保证函数值和导数值在节点处都匹配的情况下非常有用，如在数值分析中对函数的逼近，特别是在需要考虑函数局部变化率的情况下，它能提供比仅基于函数值的插值方法更精确的结果，但计算相对复杂，尤其是当节点数较多时，无论是基于基函数还是待定系数法，计算量都较大。

### 2.5分段插值方法

1. **高次多项式插值的病态问题**

    * 随着节点个数增加，高次多项式插值的次数$n$升高，但逼近$f(x)$的精度不一定增加。例如对函数$f(x)=\frac{1}{1 + x^{2}}$在$[-5,5]$上采用等间距节点插值，当节点增多时，在某些区域（如$[-2,2]$区间）能较好逼近原函数，但在高次多项式的两端会出现激烈震荡现象（龙格现象）。
2. **分段插值方法**

    * **提出**：为解决上述问题，采用分段插值方法，即把插值区间分成小区间，在小区间上用低次多项式插值。
    * **分段线性插值**

      * 当节点较多时适用。公式为$S_{i}(x)=\frac{x - x_{i + 1}}{x_{i}-x_{i + 1}}y_{i}+\frac{x - x_{i}}{x_{i + 1}-x_{i}}y_{i + 1}$，$x_{i}<x<x_{i + 1}$。从几何上看，是用折线替代曲线。例如，已知函数$y = f(x)$在$x_0 = 0$，$x_1 = 1$，$x_2 = 2$处的函数值分别为$y_0 = 1$，$y_1 = 3$，$y_2 = 5$，求$f(1.5)$的值。因为$1.5\in[1, 2]$，所以$i = 1$，代入公式得$S_{1}(1.5)=\frac{1.5 - 2}{1 - 2}\times3+\frac{1.5 - 1}{2 - 1}\times5 = 4$。
    * **分段三次插值 - 埃尔米特插值**

      * 构造分段三次插值函数$S(x)$，在每个节点处具有一阶连续导数，满足$S(x_{i}) = y_{i}$，$S'(x_{i}) = y_{i}'$，$(i = 0,1,\cdots,n)$。在每个小区间$[x_{i},x_{i + 1}]$上是三次多项式$S_{i}(x)=a_{i0}+a_{i1}x + a_{i2}x^{2}+a_{i3}x^{3}$。其分段表达式为$S(x)=\left(1 + 2\frac{x - x_{i}}{x_{i + 1}-x_{i}}\right)\left(\frac{x - x_{i + 1}}{x_{i}-x_{i + 1}}\right)^{2}y_{i}+\left(1 + 2\frac{x - x_{i + 1}}{x_{i}-x_{i + 1}}\right)\left(\frac{x - x_{i}}{x_{i + 1}-x_{i}}\right)^{2}y_{i + 1}+(x - x_{i})\left(\frac{x - x_{i + 1}}{x_{i}-x_{i + 1}}\right)^{2}y_{i}'+(x - x_{i + 1})\left(\frac{x - x_{i}}{x_{i + 1}-x_{i}}\right)^{2}y_{i + 1}'$，$x\in[x_{i},x_{i + 1}]$。例如，已知$x_0 = 0$，$x_1 = 1$，$x_2 = 2$，$y_0 = 1$，$y_1 = 2$，$y_2 = 5$，$y_0' = 1$，$y_1' = 3$，$y_2' = 9$，求$f(1.5)$的值。因为$1.5\in[1, 2]$，所以$i = 1$，代入公式计算（过程略）可得$S(1.5)$的值（假设为$3.875$，具体计算需按公式详细计算各部分）。截断误差估计$\vert R(x)\vert=\vert f(x)-S(x)\vert\leq\frac{h^{4}}{384}\max_{a\leq x\leq b}\vert f^{(4)}(x)\vert$，其中$h=\max_{0\leq i\leq n - 1}(x_{i + 1}-x_{i})$。特点是插值区间上光滑，与$f(x)$节点处密合好，显式算法收敛性好，避免龙格现象，插值函数具有局部性，但需给出所有插值节点导数值。

分段插值方法通过将区间分段，用低次多项式进行插值，有效避免了高次多项式插值的一些问题，在实际应用中，当数据点较多且函数变化较为复杂时，能在保证一定精度的同时，提高计算效率和稳定性，适用于对数据进行近似拟合和数值计算等场景。

### 2.6 样条插值

1. **提出**

    * 分段插值中低次多项式插值虽有收敛性，但存在插值函数光滑性不高的问题，Hermite 插值虽改善了光滑性却要求给出各个节点的导数值。样条插值旨在解决这些问题，其思路一是不需要给出所有节点的导数值；二是增加在区间节点上的限制条件，即插值函数的二阶导数值相等，从而使节点上插值函数光滑。
2. **样条函数的概念**

    * 对于区间 $[a, b]$ 上 $n + 1$ 个节点 $a = x_0 < x_1 < x_2 < \cdots < x_{n - 1} < x_n = b$，在对应的小区间上按一定光滑性要求“装配”起来的 $k$ 次多项式 $S_k(x)$。这里的光滑性要求为每个内节点 $x_1, \cdots, x_{n - 1}$ 上具有直到 $k - 1$ 阶连续导数。
3. **三次样条插值**

    * **构造**

      * 构造一个插值函数 $S^3(x)$ 满足在区间 $[a, b]$ 上 $n + 1$ 个节点 $(x_0, y_0), (x_1, y_1), \cdots, (x_n, y_n)$ 处 $S^3(x_i) = y_i$，$(i = 0, 1, \cdots, n)$；在每个小区间 $[x_i, x_{i + 1}]$ 上都是一个三次多项式 $S_i^3(x) = a_{i0} + a_{i1}x + a_{i2}x^2 + a_{i3}x^3$；并且 $S^3(x)$、$[S^3(x)]'$、$[S^3(x)]''$ 在 $[a, b]$ 上连续，即

        $$
        \left\{
        \begin{array}{l}
        S^3(x_i - 0) = S^3(x_i + 0) \\
        [S^3(x_i - 0)]' = [S^3(x_i + 0)]' \\
        [S^3(x_i - 0)]'' = [S^3(x_i + 0)]''
        \end{array}
        ,i = 1, 2, \cdots, n - 1
        \right.
        $$

        这样的函数称为三次样条插值函数。
    * **确定**

      * 三次样条插值多项式 $S^3(x)$ 由 $n$ 个小区间上的分段函数组成，每个小区间上三次多项式有 $4$ 个待定系数，共 $4n$ 个系数。已知条件中 $S^3(x)$ 满足插值条件可得出 $n + 1$ 个方程；满足光滑性条件（除两端点外内节点处）可得出 $3(n - 1)$ 个方程，总共 $4n - 2$ 个方程，还差 $2$ 个条件。通常在区间端点加边界条件，常用边界条件有以下三种：

        * 给定两端点处导数值（转角边界条件） $[S^3(x_0)]' = y_0'$，$[S^3(x_n)]' = y_n'$。
        * 给定两端处二阶导数值（弯矩边界条件） $[S^3(x_0)]'' = y_0''$，$[S^3(x_n)]'' = y_n''$。
        * 如果 $f(x)$ 是以 $b - a$ 为周期的周期函数，则 $S^3(x)$ 也应是具有同样周期的周期函数，在端点处需要满足 $[S^3(a + 0)]' = [S^3(b - 0)]'$，$[S^3(a + 0)]'' = [S^3(b - 0)]''$。
    * **构造方法**

      * 待定系数法计算量大。
      * 用一阶导数表示的三次样条 $S^3(x) = \varphi_0\left(\frac{x - x_i}{h_i}\right)y_i + \varphi_1\left(\frac{x - x_i}{h_i}\right)y_{i + 1} + h_i\psi_0\left(\frac{x - x_i}{h_i}\right)m_i + h_i\psi_1\left(\frac{x - x_i}{h_i}\right)m_{i + 1}$（其中 $m_i = y_i'$，$m_{i + 1} = y_{i + 1}'$）。根据三次样条函数定义，由节点二阶导数相等可得  
        ​$(1 - \alpha_i)m_{i - 1} + 2m_i + \alpha_i m_{i + 1} = \beta_i, \quad i = 1, 2, \cdots, n - 1$  
        其中 $\alpha_i = \frac{h_{i - 1}}{h_{i - 1} + h_i}$，$\beta_i = 3\left[ (1 - \alpha_i)\frac{y_i - y_{i - 1}}{h_{i - 1}} + \alpha_i\frac{y_{i + 1} - y_i}{h_i} \right]$。再结合边界条件（如给定 $m_0 = y_0'$，$m_n = y_n'$），通过解方程求出 $m_i$，代入样条函数即可。例如，已知 $x_0 = 0$，$x_1 = 1$，$x_2 = 2$，$y_0 = 1$，$y_1 = 2$，$y_2 = 5$，求 $f(1.5)$ 的值（假设采用一阶导数表示的三次样条插值，且给定两端点导数值 $m_0 = 0$，$m_2 = 6$）。

        * 首先计算 $h_0 = x_1 - x_0 = 1$，$h_1 = x_2 - x_1 = 1$。
        * 计算 $\alpha_1 = \frac{h_0}{h_0 + h_1} = \frac{1}{1 + 1} = 0.5$。
        * 计算 $\beta_1 = 3\left[ (1 - \alpha_1)\frac{y_1 - y_0}{h_0} + \alpha_1\frac{y_2 - y_1}{h_1} \right] = 3\left[ (1 - 0.5)\times(2 - 1) + 0.5\times(5 - 2) \right] = 6$。
        * 根据 $(1 - \alpha_1)m_0 + 2m_1 + \alpha_1 m_2 = \beta_1$，可得 $2m_1 + 0.5 \times 6 = 6$，解得 $m_1 = 1.5$。
        * 然后计算 $\varphi_0\left(\frac{x - x_i}{h_i}\right)$，$\varphi_1\left(\frac{x - x_i}{h_i}\right)$，$\psi_0\left(\frac{x - x_i}{h_i}\right)$，$\psi_1\left(\frac{x - x_i}{h_i}\right)$ 在 $i = 1$，$x = 1.5$ 时的值（公式略，可根据样条函数相关定义计算）。
        * 最后代入公式计算 $S^3(1.5)$ 的值（具体计算过程略），得到 $f(1.5) \approx S^3(1.5)$（最终结果根据上述计算得出）。可利用 MATLAB 函数 `interp1`​ 或 `csape`​（可输入边界条件）进行三次样条函数插值。

样条插值在数据拟合、计算机图形学、数值分析等领域有广泛应用，它能在不过多增加计算复杂度的前提下，较好地兼顾插值函数的光滑性和对数据的拟合精度，尤其适用于对数据光滑性要求较高且节点较多的情况。

### 3. 曲线拟合的最小二乘法

1. **问题引入**

    * 在工程实践和科学实验中，常需建立函数关系$y = f(x)$，但往往不知道$f(x)$的真实表达式，仅能获取一系列含误差的离散观测数据（如下表）。此时若使用插值方法，可能会因数据误差导致插值结果误差较大。因此，希望找到一个经验函数$y = s(x)$来近似真实函数$y = f(x)$，从而得到其他离散点处的函数值。

      |$x_i$​|$x_1$​|$x_2$​|$\cdots$​|$x_n$​|
      | :--: | :--: | :--: | :--: | :--: |
      |$y_i$​|$f(x_1)$​|$f(x_2)$​|$\cdots$​|$f(x_n)$​|
2. **拟合的基本思想**

    * 求一个经验函数$s(x)$，使它能“最好”地反映数据点的基本趋势。曲线拟合本质上也是函数逼近问题。
3. **直线拟合**

    * 当数据点分布接近一条直线$y = a + bx$时，由于无论如何选取$a$和$b$，直线都难以同时过全部数据点，所以需要确定“最好”的$a$和$b$值。衡量直线对数据点拟合好坏的标准可通过残差来确定。
    * 对于给定数据点$(x_i,y_i)$（$i = 1,2,\cdots,n$），若直线方程为$y = a + bx$，则近似值$y_i^* = a + bx_i$，残差$e_i = y_i - y_i^* = y_i - a - bx_i$。
    * 常见的判断直线“最好”拟合的准则有：

      * 使残差的最大绝对值最小，即$\max_i |e_i| = \min$。
      * 使残差的绝对值之和最小，即$\sum_i |e_i| = \min$。
      * 使残差的平方和最小，即$\sum_i e_i^2 = \min$（此为最小二乘法准则）。
    * 对于给定数据$(x_i,y_i)$（$i = 1,2,\cdots,N$），根据最小二乘法求$y = a + bx$的一次拟合曲线。令$Q = \sum_{i = 1}^n e_i^2 = \sum_{i = 1}^n (y_i - a - bx_i)^2$，根据函数极值方法，$\frac{\partial Q}{\partial a} = 0$且$\frac{\partial Q}{\partial b} = 0$，由此可得线性方程组

      $$
      \left\{
      \begin{array}{c}
      aN + b \sum x_i = \sum y_i \\
      a \sum x_i + b \sum x_i^2 = \sum x_i y_i
      \end{array}
      \right.
      $$
    * 解此方程组可求得$a$和$b$的值，从而确定拟合直线。例如，给定一组实验数据如下表：

      |$(i)$​|$(1)$​|$(2)$​|$(3)$​|$(4)$​|
      | :--: | :--: | :--: | :--: | :--: |
      |$(x_i)$​|$(2)$​|$(4)$​|$(6)$​|$(8)$​|
      |$(y_i)$​|$(1.1)$​|$(2.8)$​|$(4.9)$​|$(7.2)$​|
    * 这里$N = 4$，$\sum x_i = 2 + 4 + 6 + 8 = 20$，$\sum y_i = 1.1 + 2.8 + 4.9 + 7.2 = 16$，$\sum x_i^2 = 2^2 + 4^2 + 6^2 + 8^2 = 120$，$\sum x_i y_i = 2 \times 1.1 + 4 \times 2.8 + 6 \times 4.9 + 8 \times 7.2 = 100.4$。代入方程组

      $$
      \left\{
      \begin{array}{l}
      4a + 20b = 16 \\
      20a + 120b = 100.4
      \end{array}
      \right.
      $$
    * 解得$a = -1.1$，$b = 1.02$，所以拟合直线为$y = 1.02x - 1.1$。
4. **多项式拟合**

    * 给定数据$(x_i,y_i)$（$i = 1,2,\cdots,N$），求一个$m$次多项式$y = p_m(x) = a_0 + a_1x + \cdots + a_m x^m = \sum_{j = 0}^m a_j x^j$，使所有采样点的误差满足$\sum_{i = 1}^n e_i^2 = \sum_{i = 1}^n (y_i - p_m(x_i))^2 = Q(a_0, a_1, \cdots, a_m) \to \min$。
    * 由多元函数取极值的必要条件，对$Q(a_0, a_1, \cdots, a_m) = \sum_{i = 1}^N (y_i - (a_0 + a_1 x_i + \cdots + a_j x_i^j + \cdots + a_m x_i^m))^2$求关于$a_j$的偏导数并令其为0，可得$\frac{\partial Q}{\partial a_j} = -2 \sum_{i = 1}^N (y_i - \sum_{k = 0}^m a_k x_i^k) x_i^j = 0$，移项可得$\sum_{k = 0}^m a_k \left( \sum_{i = 1}^N x_i^{k + j} \right) = \sum_{i = 1}^N y_i x_i^j$（$j = 0,1,2,\cdots,m$），写成方程组为

      $$
      \left\{
      \begin{array}{l}
      a_0 N + a_1 \sum_{i=1}^N x_i + a_2 \sum_{i=1}^N x_i^2 + \cdots + a_m \sum_{i=1}^N x_i^m = \sum_{i=1}^N y_i \\
      a_0 \sum_{i=1}^N x_i + a_1 \sum_{i=1}^N x_i^2 + a_2 \sum_{i=1}^N x_i^3 + \cdots + a_m \sum_{i=1}^N x_i^{m+1} = \sum_{i=1}^N y_i x_i \\
      \vdots \\
      a_0 \sum_{i=1}^N x_i^m + a_1 \sum_{i=1}^N x_i^{m+1} + a_2 \sum_{i=1}^N x_i^{m+2} + \cdots + a_m \sum_{i=1}^N x_i^{2m} = \sum_{i=1}^N y_i x_i^m
      \end{array}
      \right.
      $$
    * 此方程组称为正则方程组或法方程组。函数组$\{1, x, x^2, \cdots, x^m\}$线性无关，可证明该方程组存在唯一解（可通过反证法，定理7 P39）。但当$m$比较大时，正则方程组可能是病态方程组。例如，求数据表的最小二乘法拟合的二次多项式函数，已知数据如下表：

      |$x_i$​|$-1$​|$-0.75$​|$-0.5$​|$-0.25$​|$0$​|$0.25$​|$0.5$​|$0.75$​|$1$​|
      | :--: | :--: | :--: | :--: | :--: | :--: | :--: | :--: | :--: | :--: |
      |$y_i$​|$50$​|$40$​|$25$​|$20$​|$18$​|$21$​|$35$​|$56$​|$66$​|
    * 可在MATLAB命令窗口实现拟合，代码如下：

      ```matlab
      x = -1:0.25:1;
      y = [50, 40, 25, 20, 18, 21, 35, 56, 66];
      p = polyfit(x, y, 2);
      xi = -1:0.01:1;
      yi = polyval(p, xi);
      plot(xi, yi, x, y, 'o');
      ```
    * 其中`polyfit`​函数用于计算拟合多项式的系数，`polyval`​函数用于根据拟合多项式计算给定$x$值处的$y$值，最后绘制出拟合曲线和原始数据点。
5. **非线性拟合模型**

    * 有时根据给定数据图形，其拟合函数$y = f(x)$表面上不是线性或多项式的形式，但通过适当变换可化为线性模型。例如，对于函数$S(x) = a e^{bx}$，两边取对数可得$\ln S(x) = \ln a + bx$，令$\overline{S}(x) = \ln S(x)$，$A = \ln a$，$B = b$，则$\overline{S}(x) = A + Bx$，这样就转化为了线性模型。然后可按照线性拟合方法进行处理，求出$A$和$B$的值，进而得到原函数的拟合参数$a$和$b$。

曲线拟合的最小二乘法在数据处理、回归分析等领域广泛应用，它能从含误差的数据中找到相对合理的函数关系来近似描述数据规律，不同的拟合方法适用于不同的数据特点和应用需求，在实际应用中可根据具体情况选择合适的拟合方式。
