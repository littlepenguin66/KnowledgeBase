分层k折交叉验证（Stratified k-fold cross-validation）是k折交叉验证的一种变体，特别适用于分类问题，并且在数据集的分类分布不平衡时非常有用。在分层k折交叉验证中，每个折都保留了数据集中所有类别的代表性样本，这意味着每个折中每个类别的样本比例与整个数据集中相同。
### 分层k折交叉验证的步骤
1. **数据分层**：首先，将数据集按照类别标签进行分层，确保每个类别中的样本在分割过程中均匀分布。
2. **分割数据集**：将每个类别中的样本随机分为k个互斥的子集，这样每个子集都包含了所有类别的样本，并且尽可能保持了数据集的原始类别比例。
3. **训练和测试**：对于每个折，执行以下步骤：
   - 将该折作为测试集。
   - 使用剩余的k-1个折作为训练集来训练模型。
   - 使用测试集来评估模型的性能。
4. **记录性能指标**：记录每次测试的性能指标，如准确率、召回率、F1分数等。
5. **计算平均性能**：将k次测试的性能指标求平均，得到模型的平均性能。
### 分层k折交叉验证的优缺点
#### 优点
- **保持类别比例**：每个折都保留了原始数据集中类别的比例，这对于类别不平衡的数据集非常重要。
- **更可靠的性能评估**：通过保持类别比例，可以更准确地评估模型在各个类别上的性能。
#### 缺点
- **计算成本**：与标准的k折交叉验证相比，分层k折交叉验证的计算成本可能更高，尤其是在类别数量较多时。
- **可能的随机性**：尽管分层有助于减少随机性，但在小数据集上，分层过程仍然可能引入一些随机性。
### 应用场景
分层k折交叉验证特别适用于以下场景：
- **类别不平衡的数据集**：在这种情况下，标准的k折交叉验证可能会导致某些折中某些类别过度表示或欠表示，从而影响模型的性能评估。
- **分类问题**：在分类问题中，保持每个折的类别分布与原始数据集相同是非常重要的，以确保模型的泛化能力。
分层k折交叉验证是一种有效的技术，可以在保持类别分布的同时，对模型的性能进行更可靠的评估。
